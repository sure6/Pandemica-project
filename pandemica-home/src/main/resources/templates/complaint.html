<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="sure" />
        <meta name="author" content="sure" />
        <title>Pandemica-Complaints</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="/css/complaint-styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand" href="#page-top">Pandemica Complaints Application</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link" href="/index">Home</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    
        <!-- Contact-->
        <section class="page-section" id="contact">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Contact Us</h2>
                    <h3 class="section-subheading text-muted">You are not satisfied with the amount of compensation, please contact us!!</h3>
                </div>
        
                <form id="contactForm" onsubmit="return func()">
                    <input type="hidden" id="userID" name="userID">
                    <div class="row align-items-stretch mb-5">
                        <div class="col-md-6">
                            <div class="form-floating mb-3">
                                <!-- Name input-->
                                <input class="form-control" id="name" type="text" readonly/>
                                <label for="name">Full name</label>
                            </div>
                            <div class="form-floating mb-3">
                                <!-- Email address input-->
                                <input class="form-control" id="email" type="email"readonly/>
                                <label for="email">Email</label>
                            </div>
                            <div class="form-floating mb-3">
                                <!-- Phone number input-->
                                <input class="form-control" id="phone" type="tel" readonly/>
                                <label for="phone">phone</label>
                            </div>
                            <div class="form-floating mb-3">
                                <div class="row">
                                <div class="col-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="position" type="text" readonly />
                                        <label for="position">Position</label>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="age" type="text" readonly/>
                                        <label for="age">Age</label>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="gender" type="text" readonly />
                                        <label for="gender">Gender</label>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="form-floating mb-3">
                                        <input class="form-control" id="applicationAmount" type="text" readonly />
                                        <label for="applicationAmount">Application Amount</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-floating mb-3">
                                <textarea class="form-control" id="applicationInfo" readonly ></textarea>
                                <label for="applicationInfo">Application Comment</label>
                            </div>
                            <div class="mb-3">
                                <select class="form-select form-select-lg" id="complaintAmount" name="complaintAmount">
                                    <option selected> Select your Amount of Compensation </option>
                                    <option value="100">AU$100</option>
                                    <option value="300">AU$300</option>
                                    <option value="500">AU$500</option>
                                </select>
                            </div>
                        </div>
                        
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating form-group-textarea mb-md-0">
                            <!-- Message input-->
                            <textarea class="form-control" id="complaintInfo" placeholder="Your Complaint Comment" name="complaintInfo"></textarea>
                            <label for="complaintInfo">Complaint Comment</label>
                        </div>
                    
                    </div>

                    </div>
                   
                    <!-- Submit Button-->
                    <div class="text-center"><button class="btn btn-primary btn-xl text-uppercase" id="submitBtn" type="submit" onclick="saveComplaintInfo()">Send Complaint Info</button></div>
                </form>
            </div>
        </section>
        <!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="text-center">Copyright &copy; Group 17 2022</div>
                
                </div>
            </div>
        </footer>
        
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="/js/complaint-scripts.js"></script>
       
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script>
            (function() {
                var username = cookie("cookie_username");
                if (username !== "") {
                    $.get("/oauth/getUserInfo/" + username, function (result) {
                        if (null != result && "" !== result) {
                            console.log(result);
                            $("#name").val(result.lastName + result.firstName);
                            $("#email").val(result.email);
                            $("#phone").val(result.phoneNumber);
                            $("#position").val(result.position);
                            $("#age").val(result.age);
                            $("#gender").val(result.gender);
                            $("#userID").val(result.userID);

                            $.get("/oauth/application/"+$("#userID").val(),function (result) {
                                console.log(result.compensationAmount);
                                if(undefined == result.compensationAmount ||undefined==result.applicationInfo){
                                    alert("You haven't even applied. please apply firstly");
                                    window.location.href="/oauth/application/apply"
                                }
                                $("#applicationAmount").val("AU$"+result.compensationAmount);
                                $("#applicationInfo").val(result.applicationInfo);
                            });
                        } else {
                            alert("user does not exist !!! return the index");
                            window.location.href = "/index";
                        }
                    });

                }
            })()
            function func(){
                return false;
            }

            // get cookie and get specific cookie
            function cookie(name) {
                var cookieArray = document.cookie.split("; ");
                var cookie = new Object();
                for (var i = 0; i < cookieArray.length; i++) {
                    var arr = cookieArray[i].split("=");
                    if (arr[0] == name) return unescape(arr[1]);
                }
                return "";
            }

            function saveComplaintInfo() {
                var confirmed = confirm("Are you sure to submit your complaint info?")
                if (confirmed) {
                    var complaintData = {};
                    complaintData.complaintInfo = $("#complaintInfo").val();
                    complaintData.complaintAmount = $("#complaintAmount").val();
                    complaintData.userID = $("#userID").val();
                    console.log(complaintData)
                    $.ajax({
                        type: "post",
                        dataType: "text",
                        contentType: "application/json; charset=utf-8",
                        url: "/oauth/saveComplaint",
                        data: JSON.stringify(complaintData),
                        success: function (result) {
                            var resultObj = JSON.parse(result);
                            alert(resultObj.returnInfo);
                            if (resultObj.stateValue === "true") {
                                setTimeout(() => {
                                    window.location.href = "/index";
                                }, 1000)

                            }
                        },
                        error: function () {
                            alert("request failed!!")
                        }
                    });
                }
            }
        </script>
    </body>
</html>
